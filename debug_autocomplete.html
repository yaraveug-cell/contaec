<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug - Autocompletado de Productos</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin-bottom: 30px; padding: 20px; border: 1px solid #ccc; }
        .form-row { margin-bottom: 15px; }
        label { display: block; font-weight: bold; margin-bottom: 5px; }
        input, select, textarea { width: 300px; padding: 8px; border: 1px solid #ccc; }
        .log { background: #f0f0f0; padding: 10px; height: 200px; overflow-y: scroll; font-family: monospace; font-size: 12px; }
        .btn { padding: 10px 20px; background: #007cba; color: white; border: none; cursor: pointer; }
        .btn:hover { background: #005a87; }
    </style>
</head>
<body>
    <h1>üß™ Debug - Autocompletado de Productos en Facturas</h1>
    
    <div class="test-section">
        <h2>üìã Datos de Productos Disponibles</h2>
        <p>Productos cargados: <strong>5</strong></p>
        <ul>
        <li><strong>AMO001</strong> - Amoladora DeWalt 4.5'' ($180.0, IVA: 5.0%)</li>
<li><strong>ASP001</strong> - Aspiradora Robot iRobot ($650.0, IVA: 15.0%)</li>
<li><strong>BIC001</strong> - Bicicleta MTB Specialized ($850.0, IVA: 15.0%)</li>
<li><strong>CAM001</strong> - Cama Matrimonial + Colch√≥n ($850.0, IVA: 15.0%)</li>
<li><strong>CAM002</strong> - Caminadora El√©ctrica ($1200.0, IVA: 15.0%)</li>
        </ul>
    </div>
    
    <div class="test-section">
        <h2>üîß Formulario de Prueba - L√≠nea de Factura</h2>
        <form>
            <div class="form-row">
                <label for="product">Producto (Select tradicional):</label>
                <select id="product" name="invoiceline-0-product">
                    <option value="">--- Seleccionar producto ---</option>
                    <option value="23">AMO001 - Amoladora DeWalt 4.5''</option>
<option value="29">ASP001 - Aspiradora Robot iRobot</option>
<option value="25">BIC001 - Bicicleta MTB Specialized</option>
<option value="21">CAM001 - Cama Matrimonial + Colch√≥n</option>
<option value="26">CAM002 - Caminadora El√©ctrica</option>
                </select>
            </div>
            
            <div class="form-row">
                <label for="description">Descripci√≥n:</label>
                <textarea id="description" name="invoiceline-0-description" rows="3"></textarea>
            </div>
            
            <div class="form-row">
                <label for="unit_price">Precio Unitario:</label>
                <input type="number" id="unit_price" name="invoiceline-0-unit_price" step="0.01">
            </div>
            
            <div class="form-row">
                <label for="iva_rate">Tasa IVA (%):</label>
                <input type="number" id="iva_rate" name="invoiceline-0-iva_rate" step="0.01">
            </div>
            
            <div class="form-row">
                <label for="quantity">Cantidad:</label>
                <input type="number" id="quantity" name="invoiceline-0-quantity" step="0.01" value="1">
            </div>
        </form>
    </div>
    
    <div class="test-section">
        <h2>üìù Log de Eventos</h2>
        <div id="log" class="log"></div>
        <button class="btn" onclick="clearLog()">Limpiar Log</button>
    </div>
    
    <script>
        // Datos de productos (simulando window.productsData)
        window.productsData = {
  "23": {
    "id": 23,
    "code": "AMO001",
    "name": "Amoladora DeWalt 4.5''",
    "description": "Amoladora DeWalt 4.5''",
    "sale_price": 180.0,
    "iva_rate": 5.0
  },
  "29": {
    "id": 29,
    "code": "ASP001",
    "name": "Aspiradora Robot iRobot",
    "description": "Aspiradora Robot iRobot",
    "sale_price": 650.0,
    "iva_rate": 15.0
  },
  "25": {
    "id": 25,
    "code": "BIC001",
    "name": "Bicicleta MTB Specialized",
    "description": "Bicicleta MTB Specialized",
    "sale_price": 850.0,
    "iva_rate": 15.0
  },
  "21": {
    "id": 21,
    "code": "CAM001",
    "name": "Cama Matrimonial + Colch√≥n",
    "description": "Cama Matrimonial + Colch√≥n",
    "sale_price": 850.0,
    "iva_rate": 15.0
  },
  "26": {
    "id": 26,
    "code": "CAM002",
    "name": "Caminadora El√©ctrica",
    "description": "Caminadora El√©ctrica",
    "sale_price": 1200.0,
    "iva_rate": 15.0
  }
};
        
        // Log de eventos
        function log(message) {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += '[' + timestamp + '] ' + message + '\n';
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }
        
        // Override console.log para mostrar en el log
        const originalConsoleLog = console.log;
        console.log = function(...args) {
            originalConsoleLog.apply(console, args);
            log(args.join(' '));
        };
        
        log('üöÄ P√°gina de debug cargada');
        log('üì¶ Productos disponibles: ' + Object.keys(window.productsData).length);
    </script>
    
    <!-- Cargar el JavaScript de autocompletado -->
    <script src="/static/admin/js/invoice_line_autocomplete.js"></script>
    
    <script>
        // Verificar que el script se carg√≥
        document.addEventListener('DOMContentLoaded', function() {
            log('‚úÖ DOM cargado completamente');
            log('üîç Verificando configuraci√≥n de autocompletado...');
            
            // Simular selecci√≥n de producto despu√©s de 2 segundos
            setTimeout(function() {
                log('üß™ Iniciando prueba autom√°tica...');
                const productSelect = document.getElementById('product');
                if (productSelect.options.length > 1) {
                    productSelect.value = productSelect.options[1].value;
                    log('üìã Producto seleccionado: ' + productSelect.options[1].text);
                    
                    // Disparar evento change
                    const changeEvent = new Event('change', { bubbles: true });
                    productSelect.dispatchEvent(changeEvent);
                    log('üîÑ Evento change disparado');
                }
            }, 3000);
        });
    </script>
</body>
</html>